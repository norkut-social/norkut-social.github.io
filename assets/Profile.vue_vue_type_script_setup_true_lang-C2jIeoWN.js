var B=Object.defineProperty;var K=(e,t,s)=>t in e?B(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var h=(e,t,s)=>K(e,typeof t!="symbol"?t+"":t,s);import{s as T,a as Q,g as V,u as G}from"./Ndk-DC06sGGr.js";import{q as R,s as X,v as N,d as Y,e as Z,o as ee,c as te,b as m,k as se,w as ie,t as ne,g as H,n as re,u as oe}from"./index-CL40LWZQ.js";var P=Symbol("verified"),ae=e=>e instanceof Object;function le(e){if(!ae(e)||typeof e.kind!="number"||typeof e.content!="string"||typeof e.created_at!="number"||typeof e.pubkey!="string"||!e.pubkey.match(/^[a-f0-9]{64}$/)||!Array.isArray(e.tags))return!1;for(let t=0;t<e.tags.length;t++){let s=e.tags[t];if(!Array.isArray(s))return!1;for(let n=0;n<s.length;n++)if(typeof s[n]=="object")return!1}return!0}new TextDecoder("utf-8");var he=new TextEncoder;function A(e){e.indexOf("://")===-1&&(e="wss://"+e);let t=new URL(e);return t.pathname=t.pathname.replace(/\/+/g,"/"),t.pathname.endsWith("/")&&(t.pathname=t.pathname.slice(0,-1)),(t.port==="80"&&t.protocol==="ws:"||t.port==="443"&&t.protocol==="wss:")&&(t.port=""),t.searchParams.sort(),t.hash="",t.toString()}var ce=class{constructor(e){h(this,"value");h(this,"next",null);h(this,"prev",null);this.value=e}},fe=class{constructor(){h(this,"first");h(this,"last");this.first=null,this.last=null}enqueue(e){const t=new ce(e);return this.last?this.last===this.first?(this.last=t,this.last.prev=this.first,this.first.next=t):(t.prev=this.last,this.last.next=t,this.last=t):(this.first=t,this.last=t),!0}dequeue(){if(!this.first)return null;if(this.first===this.last){const t=this.first;return this.first=null,this.last=null,t.value}const e=this.first;return this.first=e.next,e.value}},ue=class{generateSecretKey(){return T.utils.randomPrivateKey()}getPublicKey(e){return R(T.getPublicKey(e))}finalizeEvent(e,t){const s=e;return s.pubkey=R(T.getPublicKey(t)),s.id=q(s),s.sig=R(T.sign(q(s),t)),s[P]=!0,s}verifyEvent(e){if(typeof e[P]=="boolean")return e[P];const t=q(e);if(t!==e.id)return e[P]=!1,!1;try{const s=T.verify(e.sig,t,e.pubkey);return e[P]=s,s}catch{return e[P]=!1,!1}}};function de(e){if(!le(e))throw new Error("can't serialize event with wrong or missing properties");return JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content])}function q(e){let t=Q(he.encode(de(e)));return R(t)}var I=new ue;I.generateSecretKey;I.getPublicKey;I.finalizeEvent;var pe=I.verifyEvent,ge=22242;function be(e,t){if(e.ids&&e.ids.indexOf(t.id)===-1||e.kinds&&e.kinds.indexOf(t.kind)===-1||e.authors&&e.authors.indexOf(t.pubkey)===-1)return!1;for(let s in e)if(s[0]==="#"){let n=s.slice(1),r=e[`#${n}`];if(r&&!t.tags.find(([o,i])=>o===s.slice(1)&&r.indexOf(i)!==-1))return!1}return!(e.since&&t.created_at<e.since||e.until&&t.created_at>e.until)}function ve(e,t){for(let s=0;s<e.length;s++)if(be(e[s],t))return!0;return!1}function ye(e,t){let s=t.length+3,n=e.indexOf(`"${t}":`)+s,r=e.slice(n).indexOf('"')+n+1;return e.slice(r,r+64)}function me(e){let t=e.slice(0,22).indexOf('"EVENT"');if(t===-1)return null;let s=e.slice(t+7+1).indexOf('"');if(s===-1)return null;let n=t+7+1+s,r=e.slice(n+1,80).indexOf('"');if(r===-1)return null;let o=n+1+r;return e.slice(n+1,o)}function we(e,t){return{kind:ge,created_at:Math.floor(Date.now()/1e3),tags:[["relay",e],["challenge",t]],content:""}}async function _e(){return new Promise(e=>{const t=new MessageChannel,s=()=>{t.port1.removeEventListener("message",s),e()};t.port1.addEventListener("message",s),t.port2.postMessage(0),t.port1.start()})}var Ee=e=>(e[P]=!0,!0),L=class{constructor(e,t){h(this,"url");h(this,"_connected",!1);h(this,"onclose",null);h(this,"onnotice",e=>console.debug(`NOTICE from ${this.url}: ${e}`));h(this,"_onauth",null);h(this,"baseEoseTimeout",4400);h(this,"connectionTimeout",4400);h(this,"openSubs",new Map);h(this,"connectionTimeoutHandle");h(this,"connectionPromise");h(this,"openCountRequests",new Map);h(this,"openEventPublishes",new Map);h(this,"ws");h(this,"incomingMessageQueue",new fe);h(this,"queueRunning",!1);h(this,"challenge");h(this,"serial",0);h(this,"verifyEvent");h(this,"_WebSocket");this.url=A(e),this.verifyEvent=t.verifyEvent,this._WebSocket=t.websocketImplementation||WebSocket}static async connect(e,t){const s=new L(e,t);return await s.connect(),s}closeAllSubscriptions(e){for(let[t,s]of this.openSubs)s.close(e);this.openSubs.clear();for(let[t,s]of this.openEventPublishes)s.reject(new Error(e));this.openEventPublishes.clear();for(let[t,s]of this.openCountRequests)s.reject(new Error(e));this.openCountRequests.clear()}get connected(){return this._connected}async connect(){return this.connectionPromise?this.connectionPromise:(this.challenge=void 0,this.connectionPromise=new Promise((e,t)=>{this.connectionTimeoutHandle=setTimeout(()=>{var s;t("connection timed out"),this.connectionPromise=void 0,(s=this.onclose)==null||s.call(this),this.closeAllSubscriptions("relay connection timed out")},this.connectionTimeout);try{this.ws=new this._WebSocket(this.url)}catch(s){t(s);return}this.ws.onopen=()=>{clearTimeout(this.connectionTimeoutHandle),this._connected=!0,e()},this.ws.onerror=s=>{var n;t(s.message||"websocket error"),this._connected&&(this._connected=!1,this.connectionPromise=void 0,(n=this.onclose)==null||n.call(this),this.closeAllSubscriptions("relay connection errored"))},this.ws.onclose=async()=>{var s;this._connected&&(this._connected=!1,this.connectionPromise=void 0,(s=this.onclose)==null||s.call(this),this.closeAllSubscriptions("relay connection closed"))},this.ws.onmessage=this._onmessage.bind(this)}),this.connectionPromise)}async runQueue(){for(this.queueRunning=!0;this.handleNext()!==!1;)await _e();this.queueRunning=!1}handleNext(){var s,n,r;const e=this.incomingMessageQueue.dequeue();if(!e)return!1;const t=me(e);if(t){const o=this.openSubs.get(t);if(!o)return;const i=ye(e,"id"),a=(s=o.alreadyHaveEvent)==null?void 0:s.call(o,i);if((n=o.receivedEvent)==null||n.call(o,this,i),a)return}try{let o=JSON.parse(e);switch(o[0]){case"EVENT":{const i=this.openSubs.get(o[1]),a=o[2];this.verifyEvent(a)&&ve(i.filters,a)&&i.onevent(a);return}case"COUNT":{const i=o[1],a=o[2],l=this.openCountRequests.get(i);l&&(l.resolve(a.count),this.openCountRequests.delete(i));return}case"EOSE":{const i=this.openSubs.get(o[1]);if(!i)return;i.receivedEose();return}case"OK":{const i=o[1],a=o[2],l=o[3],u=this.openEventPublishes.get(i);a?u.resolve(l):u.reject(new Error(l)),this.openEventPublishes.delete(i);return}case"CLOSED":{const i=o[1],a=this.openSubs.get(i);if(!a)return;a.closed=!0,a.close(o[2]);return}case"NOTICE":this.onnotice(o[1]);return;case"AUTH":{this.challenge=o[1],(r=this._onauth)==null||r.call(this,o[1]);return}}}catch{return}}async send(e){if(!this.connectionPromise)throw new Error("sending on closed connection");this.connectionPromise.then(()=>{var t;(t=this.ws)==null||t.send(e)})}async auth(e){if(!this.challenge)throw new Error("can't perform auth, no challenge was received");const t=await e(we(this.url,this.challenge)),s=new Promise((n,r)=>{this.openEventPublishes.set(t.id,{resolve:n,reject:r})});return this.send('["AUTH",'+JSON.stringify(t)+"]"),s}async publish(e){const t=new Promise((s,n)=>{this.openEventPublishes.set(e.id,{resolve:s,reject:n})});return this.send('["EVENT",'+JSON.stringify(e)+"]"),t}async count(e,t){this.serial++;const s=(t==null?void 0:t.id)||"count:"+this.serial,n=new Promise((r,o)=>{this.openCountRequests.set(s,{resolve:r,reject:o})});return this.send('["COUNT","'+s+'",'+JSON.stringify(e).substring(1)),n}subscribe(e,t){const s=this.prepareSubscription(e,t);return s.fire(),s}prepareSubscription(e,t){this.serial++;const s=t.id||"sub:"+this.serial,n=new Se(this,s,e,t);return this.openSubs.set(s,n),n}close(){var e;this.closeAllSubscriptions("relay connection closed by us"),this._connected=!1,(e=this.ws)==null||e.close()}_onmessage(e){this.incomingMessageQueue.enqueue(e.data),this.queueRunning||this.runQueue()}},Se=class{constructor(e,t,s,n){h(this,"relay");h(this,"id");h(this,"closed",!1);h(this,"eosed",!1);h(this,"filters");h(this,"alreadyHaveEvent");h(this,"receivedEvent");h(this,"onevent");h(this,"oneose");h(this,"onclose");h(this,"eoseTimeout");h(this,"eoseTimeoutHandle");this.relay=e,this.filters=s,this.id=t,this.alreadyHaveEvent=n.alreadyHaveEvent,this.receivedEvent=n.receivedEvent,this.eoseTimeout=n.eoseTimeout||e.baseEoseTimeout,this.oneose=n.oneose,this.onclose=n.onclose,this.onevent=n.onevent||(r=>{console.warn(`onevent() callback not defined for subscription '${this.id}' in relay ${this.relay.url}. event received:`,r)})}fire(){this.relay.send('["REQ","'+this.id+'",'+JSON.stringify(this.filters).substring(1)),this.eoseTimeoutHandle=setTimeout(this.receivedEose.bind(this),this.eoseTimeout)}receivedEose(){var e;this.eosed||(clearTimeout(this.eoseTimeoutHandle),this.eosed=!0,(e=this.oneose)==null||e.call(this))}close(e="closed by caller"){var t;!this.closed&&this.relay.connected&&(this.relay.send('["CLOSE",'+JSON.stringify(this.id)+"]"),this.closed=!0),this.relay.openSubs.delete(this.id),(t=this.onclose)==null||t.call(this,e)}},xe=class{constructor(e){h(this,"relays",new Map);h(this,"seenOn",new Map);h(this,"trackRelays",!1);h(this,"verifyEvent");h(this,"trustedRelayURLs",new Set);h(this,"_WebSocket");this.verifyEvent=e.verifyEvent,this._WebSocket=e.websocketImplementation}async ensureRelay(e,t){e=A(e);let s=this.relays.get(e);return s||(s=new L(e,{verifyEvent:this.trustedRelayURLs.has(e)?Ee:this.verifyEvent,websocketImplementation:this._WebSocket}),t!=null&&t.connectionTimeout&&(s.connectionTimeout=t.connectionTimeout),this.relays.set(e,s)),await s.connect(),s}close(e){e.map(A).forEach(t=>{var s;(s=this.relays.get(t))==null||s.close()})}subscribeMany(e,t,s){return this.subscribeManyMap(Object.fromEntries(e.map(n=>[n,t])),s)}subscribeManyMap(e,t){this.trackRelays&&(t.receivedEvent=(f,d)=>{let g=this.seenOn.get(d);g||(g=new Set,this.seenOn.set(d,g)),g.add(f)});const s=new Set,n=[],r=Object.keys(e).length,o=[];let i=f=>{var d;o[f]=!0,o.filter(g=>g).length===r&&((d=t.oneose)==null||d.call(t),i=()=>{})};const a=[];let l=(f,d)=>{var g;i(f),a[f]=d,a.filter(w=>w).length===r&&((g=t.onclose)==null||g.call(t,a),l=()=>{})};const u=f=>{var g;if((g=t.alreadyHaveEvent)!=null&&g.call(t,f))return!0;const d=s.has(f);return s.add(f),d},c=Promise.all(Object.entries(e).map(async(f,d,g)=>{if(g.indexOf(f)!==d){l(d,"duplicate url");return}let[w,M]=f;w=A(w);let b;try{b=await this.ensureRelay(w,{connectionTimeout:t.maxWait?Math.max(t.maxWait*.8,t.maxWait-1e3):void 0})}catch(p){l(d,(p==null?void 0:p.message)||String(p));return}let y=b.subscribe(M,{...t,oneose:()=>i(d),onclose:p=>l(d,p),alreadyHaveEvent:u,eoseTimeout:t.maxWait});n.push(y)}));return{async close(){await c,n.forEach(f=>{f.close()})}}}subscribeManyEose(e,t,s){const n=this.subscribeMany(e,t,{...s,oneose(){n.close()}});return n}async querySync(e,t,s){return new Promise(async n=>{const r=[];this.subscribeManyEose(e,[t],{...s,onevent(o){r.push(o)},onclose(o){n(r)}})})}async get(e,t,s){t.limit=1;const n=await this.querySync(e,t,s);return n.sort((r,o)=>o.created_at-r.created_at),n[0]||null}publish(e,t){return e.map(A).map(async(s,n,r)=>r.indexOf(s)!==n?Promise.reject("duplicate url"):(await this.ensureRelay(s)).publish(t))}listConnectionStatus(){const e=new Map;return this.relays.forEach((t,s)=>e.set(s,t.connected)),e}destroy(){this.relays.forEach(e=>e.close()),this.relays=new Map}},U;try{U=WebSocket}catch{}var ke=class extends xe{constructor(){super({verifyEvent:pe,websocketImplementation:U})}},j={exports:{}},$={exports:{}};/**
* A handy class to calculate color values.
*
* @version 1.0
* @author Robert Eisele <robert@xarg.org>
* @copyright Copyright (c) 2010, Robert Eisele
* @link http://www.xarg.org/2010/03/generate-client-side-png-files-using-javascript/
* @license http://www.opensource.org/licenses/bsd-license.php BSD License
*
*/var W;function Pe(){return W||(W=1,function(e){(function(){function t(i,a){for(var l=2;l<arguments.length;l++)for(var u=0;u<arguments[l].length;u++)i[a++]=arguments[l].charAt(u)}function s(i){return String.fromCharCode(i>>8&255,i&255)}function n(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function r(i){return String.fromCharCode(i&255,i>>8&255)}var o=function(i,a,l){this.width=i,this.height=a,this.depth=l,this.pix_size=a*(i+1),this.data_size=2+this.pix_size+5*Math.floor((65534+this.pix_size)/65535)+4,this.ihdr_offs=0,this.ihdr_size=25,this.plte_offs=this.ihdr_offs+this.ihdr_size,this.plte_size=8+3*l+4,this.trns_offs=this.plte_offs+this.plte_size,this.trns_size=8+l+4,this.idat_offs=this.trns_offs+this.trns_size,this.idat_size=8+this.data_size+4,this.iend_offs=this.idat_offs+this.idat_size,this.iend_size=12,this.buffer_size=this.iend_offs+this.iend_size,this.buffer=new Array,this.palette=new Object,this.pindex=0;for(var u=new Array,c=0;c<this.buffer_size;c++)this.buffer[c]="\0";t(this.buffer,this.ihdr_offs,n(this.ihdr_size-12),"IHDR",n(i),n(a),"\b"),t(this.buffer,this.plte_offs,n(this.plte_size-12),"PLTE"),t(this.buffer,this.trns_offs,n(this.trns_size-12),"tRNS"),t(this.buffer,this.idat_offs,n(this.idat_size-12),"IDAT"),t(this.buffer,this.iend_offs,n(this.iend_size-12),"IEND");var f=30912;f+=31-f%31,t(this.buffer,this.idat_offs+8,s(f));for(var c=0;(c<<16)-1<this.pix_size;c++){var d,g;c+65535<this.pix_size?(d=65535,g="\0"):(d=this.pix_size-(c<<16)-c,g=""),t(this.buffer,this.idat_offs+8+2+(c<<16)+(c<<2),g,r(d),r(~d))}for(var c=0;c<256;c++){for(var w=c,M=0;M<8;M++)w&1?w=-306674912^w>>1&2147483647:w=w>>1&2147483647;u[c]=w}this.index=function(b,y){var p=y*(this.width+1)+b+1,v=this.idat_offs+8+2+5*Math.floor(p/65535+1)+p;return v},this.color=function(b,y,p,v){v=v>=0?v:255;var _=((v<<8|b)<<8|y)<<8|p;if(typeof this.palette[_]>"u"){if(this.pindex==this.depth)return"\0";var E=this.plte_offs+8+3*this.pindex;this.buffer[E+0]=String.fromCharCode(b),this.buffer[E+1]=String.fromCharCode(y),this.buffer[E+2]=String.fromCharCode(p),this.buffer[this.trns_offs+8+this.pindex]=String.fromCharCode(v),this.palette[_]=String.fromCharCode(this.pindex++)}return this.palette[_]},this.getBase64=function(){var b=this.getDump(),y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",p,v,_,E,C,S,z,O=b.length,x=0,k="";do p=b.charCodeAt(x),E=p>>2,v=b.charCodeAt(x+1),C=(p&3)<<4|v>>4,_=b.charCodeAt(x+2),O<x+2?S=64:S=(v&15)<<2|_>>6,O<x+3?z=64:z=_&63,k+=y.charAt(E)+y.charAt(C)+y.charAt(S)+y.charAt(z);while((x+=3)<O);return k},this.getDump=function(){for(var b=65521,y=5552,p=1,v=0,_=y,E=0;E<this.height;E++)for(var C=-1;C<this.width;C++)p+=this.buffer[this.index(C,E)].charCodeAt(0),v+=p,(_-=1)==0&&(p%=b,v%=b,_=y);p%=b,v%=b,t(this.buffer,this.idat_offs+this.idat_size-8,n(v<<16|p));function S(z,O,x){for(var k=-1,D=4;D<x-4;D+=1)k=u[(k^z[O+D].charCodeAt(0))&255]^k>>8&16777215;t(z,O+x-4,n(k^-1))}return S(this.buffer,this.ihdr_offs,this.ihdr_size),S(this.buffer,this.plte_offs,this.plte_size),S(this.buffer,this.trns_offs,this.trns_size),S(this.buffer,this.idat_offs,this.idat_size),S(this.buffer,this.iend_offs,this.iend_size),`PNG\r

`+this.buffer.join("")}};e.exports=o})()}($)),$.exports}(function(e){(function(){var t;t=Pe();var s=function(r,o){if(typeof r!="string"||r.length<15)throw"A hash of at least 15 characters is required.";this.defaults={background:[240,240,240,255],margin:.08,size:64,saturation:.7,brightness:.5,format:"png"},this.options=typeof o=="object"?o:this.defaults,typeof arguments[1]=="number"&&(this.options.size=arguments[1]),arguments[2]&&(this.options.margin=arguments[2]),this.hash=r,this.background=this.options.background||this.defaults.background,this.size=this.options.size||this.defaults.size,this.format=this.options.format||this.defaults.format,this.margin=this.options.margin!==void 0?this.options.margin:this.defaults.margin;var i=parseInt(this.hash.substr(-7),16)/268435455,a=this.options.saturation||this.defaults.saturation,l=this.options.brightness||this.defaults.brightness;this.foreground=this.options.foreground||this.hsl2rgb(i,a,l)};s.prototype={background:null,foreground:null,hash:null,margin:null,size:null,format:null,image:function(){return this.isSvg()?new n(this.size,this.foreground,this.background):new t(this.size,this.size,256)},render:function(){var r=this.image(),o=this.size,i=Math.floor(o*this.margin),a=Math.floor((o-i*2)/5),l=Math.floor((o-a*5)/2),u=r.color.apply(r,this.background),c=r.color.apply(r,this.foreground),f,d;for(f=0;f<15;f++)d=parseInt(this.hash.charAt(f),16)%2?u:c,f<5?this.rectangle(2*a+l,f*a+l,a,a,d,r):f<10?(this.rectangle(1*a+l,(f-5)*a+l,a,a,d,r),this.rectangle(3*a+l,(f-5)*a+l,a,a,d,r)):f<15&&(this.rectangle(0*a+l,(f-10)*a+l,a,a,d,r),this.rectangle(4*a+l,(f-10)*a+l,a,a,d,r));return r},rectangle:function(r,o,i,a,l,u){if(this.isSvg())u.rectangles.push({x:r,y:o,w:i,h:a,color:l});else{var c,f;for(c=r;c<r+i;c++)for(f=o;f<o+a;f++)u.buffer[u.index(c,f)]=l}},hsl2rgb:function(r,o,i){return r*=6,o=[i+=o*=i<.5?i:1-i,i-r%1*o*2,i-=o*=2,i,i+r%1*o,i+o],[o[~~r%6]*255,o[(r|16)%6]*255,o[(r|8)%6]*255]},toString:function(r){return r?this.render().getDump():this.render().getBase64()},isSvg:function(){return this.format.match(/svg/i)}};var n=function(r,o,i){this.size=r,this.foreground=this.color.apply(this,o),this.background=this.color.apply(this,i),this.rectangles=[]};n.prototype={size:null,foreground:null,background:null,rectangles:null,color:function(r,o,i,a){var l=[r,o,i].map(Math.round);return l.push(a>=0&&a<=255?a/255:1),"rgba("+l.join(",")+")"},getDump:function(){var r,o,i,a=this.foreground,l=this.background,u=this.size*.005;for(o="<svg xmlns='http://www.w3.org/2000/svg' width='"+this.size+"' height='"+this.size+"' style='background-color:"+l+";'><g style='fill:"+a+"; stroke:"+a+"; stroke-width:"+u+";'>",r=0;r<this.rectangles.length;r++)i=this.rectangles[r],i.color!=l&&(o+="<rect  x='"+i.x+"' y='"+i.y+"' width='"+i.w+"' height='"+i.h+"'/>");return o+="</g></svg>",o},getBase64:function(){if(typeof btoa=="function")return btoa(this.getDump());if(Buffer)return new Buffer(this.getDump(),"binary").toString("base64");throw"Cannot generate base64 output"}},e.exports=s})()})(j);var Ce=j.exports;const ze=V(Ce);function Oe(e){return`data:image/svg+xml;base64,${new ze(e,{format:"svg",foreground:[237,37,144,255],background:[255,255,255,255]}).toString()}`}new ke;function J(e){for(let t=e.length-1;t>0;t--){const s=Math.floor(Math.random()*(t+1));[e[t],e[s]]=[e[s],e[t]]}return e}function F(e,t=!0){if(e.length<=18)return e;const s=e.slice(0,4),n=e.slice(-4);let r=`${s}...${n}`;return t||(r=`${s}...`),r}const Ne=X({id:"user-store",state:()=>({npub:"",pubkey:"",name:"",picture:"",about:"",nip05:"",lud16:"",customRelays:[],followings:[],followingsCounter:0,followers:[],followersCounter:0,feed:[],communities:[],signedIn:!1,loggedOut:!0}),actions:{setNpub(e){this.npub=e},setName(e){this.name=e},async login(e,t){this.pubkey=e.pubkey,await this.fetchProfile(e,t),this.signedIn=!0,this.loggedOut=!1,this.fetchFollowings(e,t),this.fetchFollowers(e,t)},logout(){this.loggedOut=!0,this.signedIn=!1},async fetchProfile(e,t){this.picture="";try{e=t.getUser({npub:e.npub}),e.profile===void 0&&(await e.fetchProfile(),console.log(e),this.pubkey=e.profile.pubkey,this.npub=e.npub,this.name=e.profile.displayName||e.profile.display_name||e.profile.name,this.picture=e.profile.image,this.about=e.profile.about,this.nip05=e.profile.nip05,this.lud16=e.profile.lud16)}catch(s){console.log(s)}},async fetchFollowings(e,t){this.followings=[],this.followingsCounter=0;let s=await t.fetchEvents({kinds:[3],authors:[e.pubkey]},{subId:"followings"});if(s=Array.from(s),s.length>0){let n=s[0].tags.filter(i=>i[0]==="p").map(i=>i[1]);n=J(n),this.followingsCounter=n.length,n.forEach(async i=>{let a=N(i);this.followings.push({npub:a,name:F(a)})});let r=1e3,o=[];if(this.followingsCounter>=1500)for(let i=0;i<Math.ceil(this.followingsCounter/r);i++){let a=n.slice(i*r,(i+1)*r);(await t.fetchEvents({kinds:[0],authors:a},{subId:"followings-profiles"})).forEach(async u=>{let c=JSON.parse(u.content);c.npub=N(u.pubkey),c.name=c.display_name||c.name||c.displayName,o.push(c)}),this.followings=o}else(await t.fetchEvents({kinds:[0],authors:n},{subId:"followings-profiles"})).forEach(async a=>{let l=JSON.parse(a.content);l.npub=N(a.pubkey),l.name=l.display_name||l.name||l.displayName,o.push(l)}),this.followings=o}},async fetchFollowers(e,t){this.followers=[],this.followersCounter=0;let s=await t.fetchEvents({kinds:[3],"#p":[e.pubkey]},{subId:"followers"});s=Array.from(s);let n=[];if(s.length>0){s=s.filter((i,a,l)=>a===l.findIndex(u=>u.pubkey===i.pubkey)),s.forEach(i=>{i.kind===3&&n.push(i.pubkey)}),n=J(n),this.followersCounter=n.length,n.forEach(async i=>{let a=N(i);this.followers.push({npub:a,name:F(a)})});let r=1e3,o=[];if(this.followersCounter>=1500)for(let i=0;i<Math.ceil(this.followersCounter/r);i++){let a=n.slice(i*r,(i+1)*r);(await t.fetchEvents({kinds:[0],authors:a},{subId:"followers-profiles"})).forEach(async u=>{let c=JSON.parse(u.content);c.npub=N(u.pubkey),c.name=c.display_name||c.name||c.displayName,o.push(c)}),this.followings=o}else(await t.fetchEvents({kinds:[0],authors:n},{subId:"followers-profiles"})).forEach(async a=>{let l=JSON.parse(a.content);l.npub=N(a.pubkey),l.name=l.display_name||l.name||l.displayName,o.push(l)}),this.followers=o}},async fetchFeed(e,t){this.feed=[],(await t.fetchEvents({kinds:[1],authors:[e.pubkey],limit:1e3},{subId:"feed"})).forEach(async n=>{if(n.kind===1){if(n.tags.some(l=>l.includes("e")))return;let r=n.content.replace(/<br\s*\/?>/gi,`
`);r=r.replace(/(https?:\/\/\S+\.(?:png|jpg|jpeg|gif|webp))/gi,'<img src="$1" alt="Image" style="width:100%">'),r=r.replace(/\n/g,"<br>");const o=/https:\/\/(?!.*(?:jpg|jpeg|png|gif|bmp|webp|mp4|avi|mov|wmv|flv|mkv|youtube\.com|youtu\.be))[^ \n"<>'"]+/gi;r=r.replace(o,l=>`<a href="${l}" target="_blank">${l}</a>`);const i=/(https?:\/\/\S+\.(?:mp4|webm|ogg|mov))/g;r=r.replace(i,'<video controls><source src="$1" type="video/mp4">Your browser does not support the video tag.</video>');const a=/\bnostr:(npub[0-9a-z]+)\b/g;r=r.replace(a,(l,u)=>`<a href="/profile/${u}">${u}</a>`),n.content=r,this.feed.push(n)}n.kind===6&&(n.content=JSON.parse(n.content),n.content.loading=!0,this.feed.push(n))}),this.feed=this.feed.sort((n,r)=>r.created_at-n.created_at)},async fetchProfileKind0(e,t){try{const s={kinds:[0],authors:[e.hexpubkey]};return await t.fetchEvent(s)}catch(s){console.log(s),alert(s)}}},getters:{}}),Te={class:"user"},Ae=["src"],Me={class:"user-info"},Re={class:"user-info__name"},qe=Y({__name:"Profile",props:["npub"],setup(e){G();const t=e;let s={},n=Z(()=>(t.npub?s=Ne():s=oe(),s));return(r,o)=>{const i=re("router-link");return ee(),te("div",Te,[o[2]||(o[2]=m("div",{class:"user__banner"},null,-1)),se(i,{to:"",class:"user-photo circle"},{default:ie(()=>[m("img",{src:H(n).picture||H(Oe)(t.npub),alt:"",class:"user-photo__img circle"},null,8,Ae)]),_:1}),m("div",Me,[m("h1",Re,ne(H(n).name),1),o[0]||(o[0]=m("br",null,null,-1)),o[1]||(o[1]=m("a",{href:"/",class:"btn btn-primary"},"+ Seguir",-1))]),o[3]||(o[3]=m("nav",null,[m("ul",{class:"user-nav"},[m("li",null,[m("a",{href:"/",class:"active"}," Meu perfil ")]),m("li",null,[m("a",{href:"/"}," Mensagens (4) ")]),m("li",null,[m("a",{href:"/"}," Notificações ")])])],-1))])}}});export{qe as _,Oe as g,Ne as u};
